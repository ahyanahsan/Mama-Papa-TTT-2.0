<!doctype html>
<html lang="en" class="h-full">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mama Papa TTT</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/_sdk/element_sdk.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700;800&amp;display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        box-sizing: border-box;
        font-family: 'Outfit', sans-serif;
      }

      @keyframes pop {
        0% { transform: scale(0); opacity: 0; }
        50% { transform: scale(1.2); }
        100% { transform: scale(1); opacity: 1; }
      }

      @keyframes winner-glow {
        0%, 100% { box-shadow: 0 0 20px rgba(34, 197, 94, 0.6); }
        50% { box-shadow: 0 0 40px rgba(34, 197, 94, 0.9); }
      }

      @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-5px); }
        75% { transform: translateX(5px); }
      }

      .cell-mark {
        animation: pop 0.3s ease-out forwards;
      }

      .winning-cell {
        animation: winner-glow 1s ease-in-out infinite;
      }

      .draw-shake {
        animation: shake 0.5s ease-in-out;
      }
    </style>
    <style>
      @view-transition { navigation: auto; }
    </style>
    <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  </head>
  <body class="h-full">
    <div id="app-wrapper" class="h-full w-full overflow-auto">
      <div
        class="min-h-full w-full flex flex-col items-center justify-center p-6"
        style="background: linear-gradient(135deg, #0a0e27 0%, #1a1d3a 50%, #2d1b4e 100%);"
      >
        <!-- Title -->
        <h1
          id="game-title"
          class="text-4xl md:text-5xl font-extrabold mb-6 tracking-tight"
          style="color: #f7b731;"
        >
          Mama Papa TTT
        </h1>
        <!-- Theme Toggle -->
        <button
          id="theme-toggle"
          class="absolute bottom-6 left-6 px-4 py-2 rounded-full font-semibold transition-all duration-300 hover:scale-105"
          style="background: rgba(255,255,255,0.1); color: #f7b731; border: 2px solid rgba(247, 183, 49, 0.3);"
        >
          ‚òÄÔ∏è Light
        </button>
        <!-- Mode Selector -->
        <div class="flex gap-3 mb-8">
          <button
            id="mode-2player"
            class="mode-btn px-6 py-2 rounded-full font-semibold transition-all duration-300 hover:scale-105"
            style="background: linear-gradient(135deg, #f7b731, #ffa502); color: #0a0e27; box-shadow: 0 2px 10px rgba(247, 183, 49, 0.5);"
          >
            2 Players
          </button>
          <button
            id="mode-ai"
            class="mode-btn px-6 py-2 rounded-full font-semibold transition-all duration-300 hover:scale-105"
            style="background: rgba(255,255,255,0.1); color: #a0a0a0; border: 2px solid rgba(255,255,255,0.2);"
          >
            vs Robot
          </button>
        </div>
        <!-- Score Board -->
        <div class="flex items-center gap-8 mb-8">
          <div class="text-center">
            <p
              id="player-x-name"
              class="text-lg font-semibold mb-1"
              style="color: #5f27cd;"
            >
              Player X
            </p>
            <p id="score-x" class="text-3xl font-bold" style="color: #5f27cd;">
              0
            </p>
          </div>
          <div class="text-center px-6">
            <p class="text-lg font-semibold mb-1" style="color: #95a5a6;">
              Draws
            </p>
            <p
              id="score-draw"
              class="text-3xl font-bold"
              style="color: #95a5a6;"
            >
              0
            </p>
          </div>
          <div class="text-center">
            <p
              id="player-o-name"
              class="text-lg font-semibold mb-1"
              style="color: #00d2d3;"
            >
              Player O
            </p>
            <p id="score-o" class="text-3xl font-bold" style="color: #00d2d3;">
              0
            </p>
          </div>
        </div>
        <!-- Status -->
        <div
          id="status"
          class="text-xl font-semibold mb-6"
          style="color: #f8f9fa;"
        >
          Player X's turn
        </div>
        <!-- Game Board -->
        <div
          id="board"
          class="grid grid-cols-3 gap-3 p-4 rounded-2xl"
          style="background: rgba(255,255,255,0.05); backdrop-filter: blur(10px);"
        >
          <!-- Cells will be generated by JS -->
        </div>
        <!-- Reset Button -->
        <button
          id="reset-btn"
          class="mt-8 px-8 py-3 rounded-full font-bold text-lg transition-all duration-300 hover:scale-105 active:scale-95"
          style="background: linear-gradient(135deg, #f7b731, #00d2d3); color: #0a0e27; box-shadow: 0 4px 15px rgba(247, 183, 49, 0.5);"
        >
          New Game
        </button>
        <!-- Reset Scores -->
        <button
          id="reset-scores-btn"
          class="mt-3 px-6 py-2 rounded-full font-medium text-sm transition-all duration-300 hover:opacity-80"
          style="background: transparent; color: #95a5a6; border: 1px solid #95a5a6;"
        >
          Reset Scores
        </button>
        <!-- Creator Credit -->
        <div class="mt-8 text-center">
          <p
            class="text-sm font-semibold tracking-wide"
            style="color: #95a5a6;"
          >
            Created by
          </p>
          <p
            class="text-2xl font-bold mt-1 tracking-tight"
            style="color: #f7b731; text-shadow: 0 0 20px rgba(247, 183, 49, 0.6);"
          >
            Ahyan Ahsan
          </p>
        </div>
      </div>
    </div>
    <script>
      // Game State
      let board = ['', '', '', '', '', '', '', '', ''];
      let currentPlayer = 'X';
      let gameActive = true;
      let scores = { X: 0, O: 0, draw: 0 };
      let gameMode = '2player'; // '2player' or 'ai'
      let isAIThinking = false;
      let currentTheme = 'dark'; // 'dark' or 'light'

      const winningCombos = [
        [0, 1, 2], [3, 4, 5], [6, 7, 8], // Rows
        [0, 3, 6], [1, 4, 7], [2, 5, 8], // Columns
        [0, 4, 8], [2, 4, 6] // Diagonals
      ];

      // Theme configurations
      const themes = {
        dark: {
          background: 'linear-gradient(135deg, #0a0e27 0%, #1a1d3a 50%, #2d1b4e 100%)',
          backgroundColor: '#0a0e27',
          accentColor: '#f7b731',
          playerXColor: '#5f27cd',
          playerOColor: '#00d2d3',
          textColor: '#f8f9fa',
          neutralColor: '#95a5a6',
          cellBg: 'rgba(255,255,255,0.08)',
          cellBorder: 'rgba(255,255,255,0.1)',
          boardBg: 'rgba(255,255,255,0.05)'
        },
        light: {
          background: 'linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 50%, #e0c3fc 100%)',
          backgroundColor: '#f5f7fa',
          accentColor: '#e67e22',
          playerXColor: '#8e44ad',
          playerOColor: '#16a085',
          textColor: '#2c3e50',
          neutralColor: '#7f8c8d',
          cellBg: 'rgba(255,255,255,0.6)',
          cellBorder: 'rgba(0,0,0,0.1)',
          boardBg: 'rgba(255,255,255,0.4)'
        }
      };

      // Default config
      const defaultConfig = {
        game_title: 'Mama Papa TTT',
        player_x_label: 'Player X',
        player_o_label: 'Player O',
        background_color: '#0a0e27',
        accent_color: '#f7b731',
        player_x_color: '#5f27cd',
        player_o_color: '#00d2d3',
        text_color: '#f8f9fa',
        font_family: 'Outfit'
      };

      // Initialize board cells
      function initBoard() {
        const boardEl = document.getElementById('board');
        boardEl.innerHTML = '';

        for (let i = 0; i < 9; i++) {
          const cell = document.createElement('button');
          cell.className = 'cell w-20 h-20 md:w-24 md:h-24 rounded-xl flex items-center justify-center text-5xl md:text-6xl font-bold transition-all duration-200 hover:scale-105';
          cell.style.cssText = 'background: rgba(255,255,255,0.08); border: 2px solid rgba(255,255,255,0.1);';
          cell.dataset.index = i;
          cell.addEventListener('click', handleCellClick);
          boardEl.appendChild(cell);
        }
      }

      function handleCellClick(e) {
        const index = parseInt(e.target.dataset.index);

        if (board[index] !== '' || !gameActive || isAIThinking) return;

        makeMove(index);
      }

      function makeMove(index) {
        board[index] = currentPlayer;
        renderCell(index);

        const winner = checkWinner();
        if (winner) {
          gameActive = false;
          highlightWinningCells(winner.combo);
          scores[winner.player]++;
          updateScores();
          updateStatus(`${getPlayerName(winner.player)} wins! üéâ`);
        } else if (board.every(cell => cell !== '')) {
          gameActive = false;
          scores.draw++;
          updateScores();
          updateStatus("It's a draw! ü§ù");
          document.getElementById('board').classList.add('draw-shake');
          setTimeout(() => {
            document.getElementById('board').classList.remove('draw-shake');
          }, 500);
        } else {
          currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
          updateStatus(`${getPlayerName(currentPlayer)}'s turn`);

          // If AI mode and it's O's turn, let AI play
          if (gameMode === 'ai' && currentPlayer === 'O' && gameActive) {
            isAIThinking = true;
            setTimeout(() => {
              aiMove();
              isAIThinking = false;
            }, 500);
          }
        }
      }

      // AI logic using minimax algorithm
      function aiMove() {
        if (!gameActive) return;

        const bestMove = getBestMove();
        if (bestMove !== -1) {
          makeMove(bestMove);
        }
      }

      function getBestMove() {
        let bestScore = -Infinity;
        let move = -1;

        for (let i = 0; i < 9; i++) {
          if (board[i] === '') {
            board[i] = 'O';
            let score = minimax(board, 0, false);
            board[i] = '';

            if (score > bestScore) {
              bestScore = score;
              move = i;
            }
          }
        }

        return move;
      }

      function minimax(board, depth, isMaximizing) {
        const winner = checkWinner();

        if (winner && winner.player === 'O') return 10 - depth;
        if (winner && winner.player === 'X') return depth - 10;
        if (board.every(cell => cell !== '')) return 0;

        if (isMaximizing) {
          let bestScore = -Infinity;
          for (let i = 0; i < 9; i++) {
            if (board[i] === '') {
              board[i] = 'O';
              let score = minimax(board, depth + 1, false);
              board[i] = '';
              bestScore = Math.max(score, bestScore);
            }
          }
          return bestScore;
        } else {
          let bestScore = Infinity;
          for (let i = 0; i < 9; i++) {
            if (board[i] === '') {
              board[i] = 'X';
              let score = minimax(board, depth + 1, true);
              board[i] = '';
              bestScore = Math.min(score, bestScore);
            }
          }
          return bestScore;
        }
      }

      function renderCell(index) {
        const cells = document.querySelectorAll('.cell');
        const cell = cells[index];
        const theme = themes[currentTheme];

        const mark = document.createElement('span');
        mark.className = 'cell-mark';
        mark.textContent = board[index];
        mark.style.color = board[index] === 'X' ? theme.playerXColor : theme.playerOColor;

        cell.innerHTML = '';
        cell.appendChild(mark);
        cell.style.cursor = 'default';
      }

      function checkWinner() {
        for (const combo of winningCombos) {
          const [a, b, c] = combo;
          if (board[a] && board[a] === board[b] && board[a] === board[c]) {
            return { player: board[a], combo };
          }
        }
        return null;
      }

      function highlightWinningCells(combo) {
        const cells = document.querySelectorAll('.cell');
        combo.forEach(index => {
          cells[index].classList.add('winning-cell');
        });
      }

      function getPlayerName(player) {
        const config = window.elementSdk?.config || defaultConfig;
        return player === 'X'
          ? (config.player_x_label || defaultConfig.player_x_label)
          : (config.player_o_label || defaultConfig.player_o_label);
      }

      function updateStatus(text) {
        document.getElementById('status').textContent = text;
      }

      function updateScores() {
        document.getElementById('score-x').textContent = scores.X;
        document.getElementById('score-o').textContent = scores.O;
        document.getElementById('score-draw').textContent = scores.draw;
      }

      function resetGame() {
        board = ['', '', '', '', '', '', '', '', ''];
        currentPlayer = 'X';
        gameActive = true;

        const cells = document.querySelectorAll('.cell');
        cells.forEach(cell => {
          cell.innerHTML = '';
          cell.classList.remove('winning-cell');
          cell.style.cursor = 'pointer';
        });

        updateStatus(`${getPlayerName('X')}'s turn`);
      }

      function resetScores() {
        scores = { X: 0, O: 0, draw: 0 };
        updateScores();
        resetGame();
      }

      // Element SDK Integration
      async function onConfigChange(config) {
        const title = config.game_title || defaultConfig.game_title;
        const playerX = config.player_x_label || defaultConfig.player_x_label;
        const playerO = config.player_o_label || defaultConfig.player_o_label;
        const bgColor = config.background_color || defaultConfig.background_color;
        const accentColor = config.accent_color || defaultConfig.accent_color;
        const playerXColor = config.player_x_color || defaultConfig.player_x_color;
        const playerOColor = config.player_o_color || defaultConfig.player_o_color;
        const textColor = config.text_color || defaultConfig.text_color;
        const fontFamily = config.font_family || defaultConfig.font_family;

        // Update title
        document.getElementById('game-title').textContent = title;
        document.getElementById('game-title').style.color = accentColor;

        // Update player names
        document.getElementById('player-x-name').textContent = playerX;
        document.getElementById('player-x-name').style.color = playerXColor;
        document.getElementById('score-x').style.color = playerXColor;

        document.getElementById('player-o-name').textContent = playerO;
        document.getElementById('player-o-name').style.color = playerOColor;
        document.getElementById('score-o').style.color = playerOColor;

        // Update colors
        document.getElementById('status').style.color = textColor;

        const resetBtn = document.getElementById('reset-btn');
        resetBtn.style.background = `linear-gradient(135deg, ${accentColor}, ${playerOColor})`;
        resetBtn.style.boxShadow = `0 4px 15px ${accentColor}66`;

        // Update font
        document.body.style.fontFamily = `${fontFamily}, Outfit, sans-serif`;

        // Update existing marks on board
        const cells = document.querySelectorAll('.cell');
        cells.forEach((cell, index) => {
          if (board[index]) {
            const mark = cell.querySelector('span');
            if (mark) {
              mark.style.color = board[index] === 'X' ? playerXColor : playerOColor;
            }
          }
        });

        // Update status text
        if (gameActive) {
          updateStatus(`${getPlayerName(currentPlayer)}'s turn`);
        }
      }

      function mapToCapabilities(config) {
        return {
          recolorables: [
            {
              get: () => config.background_color || defaultConfig.background_color,
              set: (value) => { config.background_color = value; window.elementSdk.setConfig({ background_color: value }); }
            },
            {
              get: () => config.accent_color || defaultConfig.accent_color,
              set: (value) => { config.accent_color = value; window.elementSdk.setConfig({ accent_color: value }); }
            },
            {
              get: () => config.text_color || defaultConfig.text_color,
              set: (value) => { config.text_color = value; window.elementSdk.setConfig({ text_color: value }); }
            },
            {
              get: () => config.player_x_color || defaultConfig.player_x_color,
              set: (value) => { config.player_x_color = value; window.elementSdk.setConfig({ player_x_color: value }); }
            },
            {
              get: () => config.player_o_color || defaultConfig.player_o_color,
              set: (value) => { config.player_o_color = value; window.elementSdk.setConfig({ player_o_color: value }); }
            }
          ],
          borderables: [],
          fontEditable: {
            get: () => config.font_family || defaultConfig.font_family,
            set: (value) => { config.font_family = value; window.elementSdk.setConfig({ font_family: value }); }
          },
          fontSizeable: undefined
        };
      }

      function mapToEditPanelValues(config) {
        return new Map([
          ['game_title', config.game_title || defaultConfig.game_title],
          ['player_x_label', config.player_x_label || defaultConfig.player_x_label],
          ['player_o_label', config.player_o_label || defaultConfig.player_o_label]
        ]);
      }

      // Theme switching
      function toggleTheme() {
        currentTheme = currentTheme === 'dark' ? 'light' : 'dark';
        applyTheme();
      }

      function applyTheme() {
        const theme = themes[currentTheme];
        const wrapper = document.querySelector('#app-wrapper > div');
        const themeToggleBtn = document.getElementById('theme-toggle');

        // Update background
        wrapper.style.background = theme.background;

        // Update theme toggle button
        if (currentTheme === 'dark') {
          themeToggleBtn.innerHTML = '‚òÄÔ∏è Light';
          themeToggleBtn.style.cssText = `background: rgba(255,255,255,0.1); color: ${theme.accentColor}; border: 2px solid rgba(247, 183, 49, 0.3);`;
        } else {
          themeToggleBtn.innerHTML = 'üåô Dark';
          themeToggleBtn.style.cssText = `background: rgba(0,0,0,0.1); color: ${theme.accentColor}; border: 2px solid rgba(230, 126, 34, 0.3);`;
        }

        // Update all colored elements
        document.getElementById('game-title').style.color = theme.accentColor;
        document.getElementById('player-x-name').style.color = theme.playerXColor;
        document.getElementById('score-x').style.color = theme.playerXColor;
        document.getElementById('player-o-name').style.color = theme.playerOColor;
        document.getElementById('score-o').style.color = theme.playerOColor;
        document.getElementById('status').style.color = theme.textColor;

        const drawLabel = document.querySelector('#score-draw').previousElementSibling;
        drawLabel.style.color = theme.neutralColor;
        document.getElementById('score-draw').style.color = theme.neutralColor;

        const createdByText = document.querySelector('.mt-8.text-center p:first-child');
        const creatorName = document.querySelector('.mt-8.text-center p:last-child');
        createdByText.style.color = theme.neutralColor;
        creatorName.style.color = theme.accentColor;
        creatorName.style.textShadow = `0 0 20px ${theme.accentColor}99`;

        // Update buttons
        const resetBtn = document.getElementById('reset-btn');
        const resetScoresBtn = document.getElementById('reset-scores-btn');
        const buttonTextColor = currentTheme === 'dark' ? '#0a0e27' : '#ffffff';
        resetBtn.style.cssText = `background: linear-gradient(135deg, ${theme.accentColor}, ${theme.playerOColor}); color: ${buttonTextColor}; box-shadow: 0 4px 15px ${theme.accentColor}66;`;
        resetScoresBtn.style.cssText = `background: transparent; color: ${theme.neutralColor}; border: 1px solid ${theme.neutralColor};`;

        // Update board cells
        const cells = document.querySelectorAll('.cell');
        cells.forEach((cell, index) => {
          cell.style.background = theme.cellBg;
          cell.style.border = `2px solid ${theme.cellBorder}`;

          if (board[index]) {
            const mark = cell.querySelector('span');
            if (mark) {
              mark.style.color = board[index] === 'X' ? theme.playerXColor : theme.playerOColor;
            }
          }
        });

        // Update board background
        document.getElementById('board').style.background = theme.boardBg;

        // Update mode buttons
        updateModeButtons();
      }

      function updateModeButtons() {
        const mode2PlayerBtn = document.getElementById('mode-2player');
        const modeAIBtn = document.getElementById('mode-ai');
        const theme = themes[currentTheme];
        const buttonTextColor = currentTheme === 'dark' ? '#0a0e27' : '#ffffff';
        const inactiveButtonBg = currentTheme === 'dark' ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)';
        const inactiveButtonColor = theme.neutralColor;
        const inactiveBorder = currentTheme === 'dark' ? 'rgba(255,255,255,0.2)' : 'rgba(0,0,0,0.2)';

        if (gameMode === '2player') {
          mode2PlayerBtn.style.cssText = `background: linear-gradient(135deg, ${theme.accentColor}, #ffa502); color: ${buttonTextColor}; box-shadow: 0 2px 10px ${theme.accentColor}66;`;
          modeAIBtn.style.cssText = `background: ${inactiveButtonBg}; color: ${inactiveButtonColor}; border: 2px solid ${inactiveBorder};`;
        } else {
          modeAIBtn.style.cssText = `background: linear-gradient(135deg, ${theme.accentColor}, #ffa502); color: ${buttonTextColor}; box-shadow: 0 2px 10px ${theme.accentColor}66;`;
          mode2PlayerBtn.style.cssText = `background: ${inactiveButtonBg}; color: ${inactiveButtonColor}; border: 2px solid ${inactiveBorder};`;
        }
      }

      // Mode switching
      function setGameMode(mode) {
        gameMode = mode;
        resetScores();
        updateModeButtons();

        // Update player O name
        const playerOName = document.getElementById('player-o-name');
        const theme = themes[currentTheme];
        if (mode === 'ai') {
          playerOName.textContent = 'ü§ñ Robot';
        } else {
          const config = window.elementSdk?.config || defaultConfig;
          playerOName.textContent = config.player_o_label || defaultConfig.player_o_label;
        }
        playerOName.style.color = theme.playerOColor;
      }

      // Initialize
      initBoard();
      applyTheme();

      document.getElementById('reset-btn').addEventListener('click', resetGame);
      document.getElementById('reset-scores-btn').addEventListener('click', resetScores);
      document.getElementById('mode-2player').addEventListener('click', () => setGameMode('2player'));
      document.getElementById('mode-ai').addEventListener('click', () => setGameMode('ai'));
      document.getElementById('theme-toggle').addEventListener('click', toggleTheme);

      // Init SDK
      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange,
          mapToCapabilities,
          mapToEditPanelValues
        });
      }
    </script>
    <script>
      (function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9bcd47d15585a494',t:'MTc2ODIyNzQ3OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();
    </script>
  </body>
</html>
